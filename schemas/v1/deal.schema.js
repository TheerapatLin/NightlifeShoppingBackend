const mongoose = require("mongoose");
const { Schema, model, Types } = mongoose;

const dealSchema = new Schema({
  // üè∑Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏µ‡∏•‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô { en: "50% off", th: "‡∏•‡∏î 50%" }
  title: { type: Map, of: String, required: true },
  subTitle: { type: Map, of: String, required: true },

  // üìù ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏•‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤
  description: { type: Map, of: String, required: true },

  // ‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏µ‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‚Äú‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‚Äù (multi-language)
  howToUse: { type: Map, of: String, default: {} },

  // üß© ‡πÅ‡∏ó‡πá‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡πÄ‡∏ä‡πà‡∏ô { en: ["cocktail"], th: ["‡∏Ñ‡πá‡∏≠‡∏Å‡πÄ‡∏ó‡∏•"] }
  tags: { type: Map, of: [String], default: {} },

  // üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡∏µ‡∏• (‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå‡∏Ç‡∏≠‡∏á URL)
  images: { type: [String], default: [] },

  // üìç ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏ô ‡∏ñ‡πâ‡∏≤ null = ‡∏î‡∏µ‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
  venueId: { type: Types.ObjectId, ref: "Venue", default: null },

  // üõçÔ∏è ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á (‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå‡∏Ç‡∏≠‡∏á productId)
  productIds: [{ type: Types.ObjectId, ref: "Product" }],

  // üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏î‡∏µ‡∏• (0 = ‡∏ü‡∏£‡∏µ)
  price: { type: Number, required: true, default: 0 },

  // üíé ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ 200 ‡∏ö‡∏≤‡∏ó
  originalValue: { type: Number, required: true },

  // üî¢ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: ‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (amount) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (percentage)
  discountType: { type: String, enum: ["amount", "percentage"], required: true },

  // üîΩ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏î ‡πÄ‡∏ä‡πà‡∏ô 50 ‡∏ö‡∏≤‡∏ó ‡∏´‡∏£‡∏∑‡∏≠ 20%
  discountValue: { type: Number, required: true },

  // üìâ ‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ (nullable)
  minSpend: { type: Number, default: null },

  // üíµ ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏° (default = ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
  isRedeemableForCash: { type: Boolean, default: false },

  // üïê ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ
  claimStartDate: { type: Date, default: null },

  // üïê ‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏î‡∏µ‡∏•
  claimEndDate: { type: Date, default: null },

  // ‚è≥ ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏î‡∏µ‡∏•‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô (nullable)
  expirationDaysAfterClaim: { type: Number, default: null },

  // üìÜ ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
  fixedExpirationDate: { type: Date, default: null },

  // üïì ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÄ‡∏ä‡πà‡∏ô 15 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏î‡πÉ‡∏ä‡πâ
  expirationAfterUseMinutes: { type: Number, default: null },

  // üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏µ‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ (null = ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)
  totalAvailable: { type: Number, default: null },

  // üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏µ‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏î‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
  totalClaimed: { type: Number, default: 0 },

  // üôã ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà user ‡πÉ‡∏ä‡πâ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô (nullable = ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)
  usageLimitPerUser: { type: Number, default: 1 },

  // ‚úÖ ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  isActive: { type: Boolean, default: true },

  // üåç ‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
  isPublished: { type: Boolean, default: false },

  // üìå ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  sortOrder: { type: Number, default: 0 },

  // üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà admin ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  platformNote: { type: String, default: "" },

  // üë§ ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏µ‡∏•‡∏ô‡∏µ‡πâ
  createdBy: { type: Types.ObjectId, ref: "User" }
}, {
  timestamps: true // ‡πÄ‡∏û‡∏¥‡πà‡∏° createdAt ‡πÅ‡∏•‡∏∞ updatedAt ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
});

module.exports = model("Deal", dealSchema);
